#!/bin/bash
# oc wrapper - intercepts 'oc adm inspect' and uses kubectl_inspect

original_args=("$@")

# Check if this is 'oc adm inspect' using simple pattern match
if [[ " ${original_args[*]} " =~ " adm " ]] && [[ " ${original_args[*]} " =~ " inspect " ]]; then
    # Parse arguments
    namespace=""
    resource=""
    dest_dir=""

    i=0
    while [[ $i -lt ${#original_args[@]} ]]; do
        arg="${original_args[$i]}"
        case "$arg" in
            -n|--namespace)
                ((i++))
                namespace="${original_args[$i]}"
                ;;
            --dest-dir)  # for upstream script
                ((i++))
                dest_dir="${original_args[$i]}"
                ;;
            --dest-dir=*) # for upstream script
                dest_dir="${arg#*=}"
                ;;
            adm|inspect|--*|-*)
                # Skip keywords, flags we don't handle
                ;;
            *)
                resource="$arg"
                ;;
        esac
        ((i++))
    done

    # Source common.sh (resolve symlink first)
    SCRIPT_DIR="$(cd "$(dirname "$(readlink -f "${BASH_SOURCE[0]}")")" && pwd)"
    source "$SCRIPT_DIR/common.sh"

    # Override DST_DIR if specified
    [[ -n "$dest_dir" ]] && { export DST_DIR="$dest_dir"; mkdir -p "$DST_DIR"; }

    # Call kubectl_inspect
    if [[ -n "$namespace" ]]; then
        kubectl_inspect "$resource" "$namespace"
    else
        kubectl_inspect "$resource"
    fi
else
    # Not 'oc adm inspect' - pass through to kubectl
    kubectl "${original_args[@]}"
fi
